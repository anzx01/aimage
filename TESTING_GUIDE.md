# AIMAGE 测试指南

本文档提供完整的功能测试步骤和检查清单。

## 前置准备

### 1. 环境配置

确保已配置以下环境变量（`.env.local`）：

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 2. 启动开发服务器

```bash
cd frontend
npm install
npm run dev
```

访问：http://localhost:3000

### 3. Supabase 配置

按照 `SUPABASE_STORAGE_SETUP.md` 完成以下配置：
- [ ] 创建 `assets` bucket
- [ ] 配置 RLS 策略
- [ ] 测试文件上传权限

---

## 功能测试清单

### 一、用户认证流程

#### 1.1 注册功能
- [ ] 访问 `/signup`
- [ ] 填写邮箱、密码、姓名
- [ ] 点击注册
- [ ] 检查是否跳转到 Dashboard
- [ ] 检查 Supabase 数据库中是否创建用户记录

**预期结果**：
- 用户成功注册
- 自动登录并跳转到 Dashboard
- 初始积分为 10

#### 1.2 登录功能
- [ ] 访问 `/login`
- [ ] 输入注册的邮箱和密码
- [ ] 点击登录
- [ ] 检查是否跳转到 Dashboard

**预期结果**：
- 成功登录
- 显示用户信息和积分

#### 1.3 退出功能
- [ ] 在 Dashboard 点击"退出"
- [ ] 检查是否跳转到首页
- [ ] 尝试访问 `/dashboard`，应该重定向到登录页

---

### 二、Dashboard 功能

#### 2.1 页面加载
- [ ] 访问 `/dashboard`
- [ ] 检查是否显示欢迎信息
- [ ] 检查积分显示是否正确
- [ ] 检查统计数据（总项目数、已完成数）

#### 2.2 快速入口
- [ ] 点击"一键成片"卡片，跳转到 `/generate`
- [ ] 点击"案例库"卡片，跳转到 `/showcase`
- [ ] 点击"我的项目"卡片，跳转到 `/projects`

#### 2.3 最近项目
- [ ] 创建几个项目后，检查是否显示最近 3 个项目
- [ ] 点击项目卡片，跳转到项目详情页
- [ ] 检查项目状态标签是否正确

---

### 三、一键成片功能

#### 3.1 基础模式
- [ ] 访问 `/generate`
- [ ] 确认默认选中"基础模式"
- [ ] 填写视频标题（必填）
- [ ] 填写视频描述（可选）
- [ ] 选择视频风格
- [ ] 选择视频时长
- [ ] 检查积分消耗提示（15秒=1积分，30秒=2积分，60秒=3积分）
- [ ] 点击"开始生成"

**预期结果**：
- 创建项目成功
- 扣除相应积分
- 跳转到项目详情页

#### 3.2 高级模式
- [ ] 切换到"高级模式"
- [ ] 填写视频标题
- [ ] 上传图片文件（拖拽或点击）
- [ ] 上传视频文件
- [ ] 检查上传进度显示
- [ ] 检查文件预览
- [ ] 检查积分消耗（是基础模式的 2 倍）
- [ ] 点击"开始生成"

**预期结果**：
- 文件成功上传到 Supabase Storage
- 文件记录保存到 assets 表
- 项目关联到上传的文件
- 扣除相应积分

#### 3.3 文件上传测试

**测试用例 1：正常上传**
- [ ] 上传 JPG 图片（< 100MB）
- [ ] 上传 PNG 图片
- [ ] 上传 MP4 视频
- [ ] 检查进度条显示
- [ ] 检查上传完成提示

**测试用例 2：文件验证**
- [ ] 尝试上传超过 100MB 的文件
- [ ] 检查是否显示错误提示

**测试用例 3：多文件上传**
- [ ] 同时上传多个文件
- [ ] 检查每个文件的上传状态
- [ ] 删除某个文件
- [ ] 检查文件列表更新

---

### 四、项目管理

#### 4.1 项目列表
- [ ] 访问 `/projects`
- [ ] 检查项目网格布局
- [ ] 测试状态筛选（全部/草稿/生成中/已完成/失败）
- [ ] 点击项目卡片，跳转到详情页

#### 4.2 项目详情
- [ ] 访问 `/projects/[id]`
- [ ] 检查项目信息显示
- [ ] 检查视频播放器（如果有视频）
- [ ] 检查生成记录列表
- [ ] 检查项目素材列表
- [ ] 点击"下载视频"（如果有）
- [ ] 点击"删除项目"，确认删除

**预期结果**：
- 所有信息正确显示
- 删除后跳转到项目列表

---

### 五、用户设置

#### 5.1 个人信息
- [ ] 访问 `/settings`
- [ ] 修改姓名
- [ ] 点击"保存修改"
- [ ] 检查成功提示
- [ ] 刷新页面，检查修改是否保存

#### 5.2 密码修改
- [ ] 输入新密码
- [ ] 输入确认密码（相同）
- [ ] 点击"修改密码"
- [ ] 检查成功提示
- [ ] 退出登录
- [ ] 使用新密码登录

**测试用例：密码验证**
- [ ] 新密码少于 6 个字符，检查错误提示
- [ ] 两次密码不一致，检查错误提示

---

### 六、积分充值

#### 6.1 页面显示
- [ ] 访问 `/credits`
- [ ] 检查当前余额显示
- [ ] 检查 4 个套餐显示
- [ ] 检查赠送积分标识
- [ ] 检查积分使用说明

#### 6.2 购买流程
- [ ] 点击任意套餐的"立即购买"
- [ ] 检查提示信息（支付功能即将推出）

---

### 七、UI 组件测试

#### 7.1 Loading 组件
- [ ] 页面加载时显示 Loading
- [ ] 检查动画效果
- [ ] 检查加载文本

#### 7.2 Toast 通知
- [ ] 触发成功操作，检查绿色提示
- [ ] 触发错误操作，检查红色提示
- [ ] 检查自动消失（3秒）
- [ ] 点击关闭按钮

#### 7.3 ErrorBoundary
- [ ] 手动触发错误（开发模式）
- [ ] 检查错误页面显示
- [ ] 点击"刷新页面"
- [ ] 点击"返回首页"

---

## 数据库验证

### 检查 Supabase 数据库

#### 1. users 表
```sql
SELECT * FROM users ORDER BY created_at DESC LIMIT 5;
```
检查：
- [ ] 用户记录正确创建
- [ ] 初始积分为 10
- [ ] full_name 正确保存

#### 2. projects 表
```sql
SELECT * FROM projects ORDER BY created_at DESC LIMIT 5;
```
检查：
- [ ] 项目记录正确创建
- [ ] mode 字段（basic/advanced）
- [ ] status 字段（draft/processing/completed/failed）
- [ ] credits_used 正确记录

#### 3. generation_tasks 表
```sql
SELECT * FROM generation_tasks ORDER BY created_at DESC LIMIT 5;
```
检查：
- [ ] 任务记录正确创建
- [ ] project_id 关联正确
- [ ] model_name 正确（basic: veo3.1-fast, advanced: veo3.1-pro）

#### 4. assets 表
```sql
SELECT * FROM assets ORDER BY created_at DESC LIMIT 5;
```
检查：
- [ ] 文件记录正确创建
- [ ] file_url 可访问
- [ ] file_size 正确

#### 5. project_assets 表
```sql
SELECT * FROM project_assets ORDER BY created_at DESC LIMIT 5;
```
检查：
- [ ] 项目和素材关联正确

#### 6. credit_transactions 表
```sql
SELECT * FROM credit_transactions ORDER BY created_at DESC LIMIT 5;
```
检查：
- [ ] 积分扣除记录正确
- [ ] amount 为负数
- [ ] related_project_id 关联正确

---

## 性能测试

### 1. 页面加载速度
- [ ] 首页加载 < 2 秒
- [ ] Dashboard 加载 < 3 秒
- [ ] 项目列表加载 < 3 秒

### 2. 文件上传速度
- [ ] 10MB 图片上传 < 10 秒
- [ ] 50MB 视频上传 < 30 秒

### 3. 数据库查询
- [ ] 项目列表查询 < 1 秒
- [ ] 项目详情查询 < 1 秒

---

## 浏览器兼容性测试

测试以下浏览器：
- [ ] Chrome（最新版）
- [ ] Firefox（最新版）
- [ ] Safari（最新版）
- [ ] Edge（最新版）

检查项：
- [ ] 页面布局正常
- [ ] 功能正常工作
- [ ] 样式显示正确

---

## 移动端测试（可选）

- [ ] 在移动设备上访问
- [ ] 检查响应式布局
- [ ] 检查触摸操作

---

## 常见问题排查

### 问题 1：无法上传文件
**检查**：
1. Supabase Storage bucket 是否创建
2. RLS 策略是否配置
3. 用户是否已登录
4. 浏览器控制台是否有错误

### 问题 2：积分未扣除
**检查**：
1. credit_transactions 表是否有记录
2. users 表的 credits 字段是否更新
3. 检查浏览器控制台错误

### 问题 3：项目列表为空
**检查**：
1. projects 表是否有数据
2. user_id 是否匹配
3. 检查网络请求

### 问题 4：登录后跳转失败
**检查**：
1. 认证状态是否正确
2. 路由配置是否正确
3. 检查浏览器控制台错误

---

## 测试报告模板

```markdown
# 测试报告

**测试日期**：2026-02-16
**测试人员**：[姓名]
**测试环境**：
- 浏览器：Chrome 120
- 操作系统：Windows 11
- Node.js：v20.x

## 测试结果

### 通过的功能
- ✅ 用户注册
- ✅ 用户登录
- ✅ 项目创建（基础模式）
- ...

### 失败的功能
- ❌ 文件上传（错误：403 Forbidden）
  - 原因：RLS 策略未配置
  - 解决方案：按照 SUPABASE_STORAGE_SETUP.md 配置

### 待修复的问题
1. 文件上传进度条不显示
2. 密码修改后未自动登出
3. ...

## 建议
- 添加更多错误提示
- 优化加载速度
- ...
```

---

## 自动化测试（未来）

建议添加以下测试：
- 单元测试（Jest）
- 集成测试（Playwright）
- E2E 测试（Cypress）

---

**测试完成后**，请填写测试报告并提交问题清单。
